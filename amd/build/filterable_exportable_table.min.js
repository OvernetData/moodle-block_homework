define(["jquery","block_homework/jquery.dataTables"],function(a,b){"use strict";var c=function(){var b="",c=[0,"asc"],d="",e=0,f=null,g=M.str.block_homework,h=function(){var b=this;f!=b&&(f&&a(f).removeClass("focussed"),f=b,a(f).addClass("focussed"))},i=function(){var b=a(window).height();return b-200},j=function(d){if(a("#"+b+"_loading").css("display","none"),0==a("#"+b).length)return void console.log("No table found");if(e=i(),a("#"+b+"_loaded").css("display","block"),!a.fn.dataTableExt)return a("<p>",{"class":"alert centered",style:"margin: auto",text:"Failed to initialise DataTables plugin - this screen has lost filtering, exporting and paged display functionality."}).insertBefore(a("#"+b)),void a("<p>",{"class":"alert centered",style:"margin: auto",text:"This may be caused by a theme loading a second copy of the jQuery library without deconflicting it"}).insertBefore(a("#"+b));var f={paging:!0,ordering:!0,info:!0,searching:!0,scrollYold:e,scrollY:"50vh",scrollX:!1,scrollCollapse:!0,iDisplayLength:10,order:[c],dom:'lf<t><i<"#'+b+'_toolbar">><p>',processing:!0};"undefined"!=typeof d&&a.extend(f,d);var j=a("#"+b).DataTable(f);a("#"+b+"_toolbar").html('<div class="dataTables_paginate"><select id="'+b+'_exportdata" /><select id="'+b+'_exporttype" /><a id="'+b+'_exportbutton" class="ond_material_button_raised current" href="javascript:;">'+g["export"]+"</a></div>").css("float","left").css("padding-left","1em");var n=a("#"+b+"_exportdata");k(n,"_",g.pleaseselect),k(n,"all",g.exportall),k(n,"filtered",g.exportfiltered);var n=a("#"+b+"_exporttype");k(n,"csv",".csv"),k(n,"xls",".xls");var o=b;a(window).bind("resize",function(){m(o)}),j.on("click focusin mouseenter","tr",h);var p=a("#"+b+"_exportbutton");p.on("click",function(){l(o)})},k=function(a,b,c){a.attr("name",a.attr("id")),a.css("margin-right","1em"),a.append('<option value="'+b+'">'+c+"</option>")},l=function(c){"undefined"==typeof c&&(c=b);var e=a("#"+c+"_exportdata").val();if("_"!=e){var f=a("#"+c).DataTable(),h=a("#"+c+"_exporttype").val(),i="";i="undefined"==typeof table_filename?c.replace("_table","").replace("table",""):table_filename;var j;j="filtered"==e?f.rows({filter:"applied"}):f.rows();var k=[],l=[];if(j.data().length>0){a.each(f.columns().header(),function(b,c){k.push(a(c).html())}),l.push(k),j.every(function(b,c,d){k=[],a.each(this.data(),function(c,d){var e=a(f.cell(b,c).node()),g=e.attr("data-for-export");void 0!=g&&g!==!1?k.push(g):"object"==typeof d?d.hasOwnProperty("display")?k.push(d.display):k.push(a(d).html()):k.push(d)}),l.push(k)}),l=JSON.stringify(l);var m,n,o,p=d+"/ajax/export_table.php";0===(m=a("#download_iframe")).length&&(m=a("<iframe id='download_iframe' style='display: none' src='about:blank'></iframe>").appendTo("body")),n=m[0].contentWindow||m[0].contentDocument,n.document&&(n=n.document),o='<html><head></head><body><form method="POST" action="'+p+'"><input type="hidden" name="filename" value="'+i+'"/><input type="hidden" name="type" value="'+h+'"/><input type="hidden" name="tabledata" value="'+encodeURIComponent(l)+'"/></form></body></html>',n.open(),n.write(o),a(n).find("form").submit()}}else alert(g.allorfiltered)},m=function(b){var c=i();if(e!=c){e=c;var d=a("#"+b).dataTable();d.dataTable().fnSettings().oScroll.sY=e,d.fnAdjustColumnSizing(!0)}};this.initialise=function(a,e,f,g){"undefined"!=typeof a&&""!=a&&(b=a,"undefined"!=typeof e&&null!=e&&(c=e),d=f,j(g))},this.getInputData=function(c){"undefined"==typeof c&&(c=b);var d=a("#"+c).DataTable();return d.$("input, select, textarea")}};return new c});