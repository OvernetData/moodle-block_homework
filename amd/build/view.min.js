define(["jquery","block_homework/filterable_exportable_table"],function(a,b){"use strict";var c=function(){var c=M.cfg.wwwroot+"/blocks/homework/ajax/",d=M.str.block_homework,e=!0,f=!1;this.start=function(){a("#user1").on("change",function(){a("#displayuser").val(a("#user1").val()),a("#user2").val(a("#user1").val()),g()}),a("#user2").on("change",function(){a("#displayuser").val(a("#user2").val()),a("#user1").val(a("#user2").val()),g()}),a("#date").on("change",function(){g()}),a("#List_view-tab").on("shown.bs.tab",function(a){e=!0,h()}),a("#Timetable_view-tab").on("shown.bs.tab",function(a){e=!1}),g()};var g=function(){a("#date").prop("disabled",!0),a("#ond_homework_list_loaded").css("display","none"),a("#ond_homework_list_loading").css("display","block"),a("#ond_homework_timetable_loaded")&&(a("#ond_homework_timetable_loaded").css("display","none"),a("#ond_homework_timetable_loading").css("display","block"));var b=c+"view_timetable.php",e={course:a("#course").val(),sesskey:a("#sesskey").val(),date:a("#date").val(),displayuser:a("#displayuser").val(),user:a("#user").val(),usertype:a("#usertype").val(),marking:a("#marking").val()};a.ajax({method:"POST",url:b,data:e}).done(function(b,c,e){try{var g=JSON.parse(b)}catch(i){g=d.failedtofetchdata}"string"!=typeof g?(a("#ond_homework_list_loaded").html(g.htmllist),f=!1,a("#ond_homework_list_loading").css("display","none"),a("#ond_homework_list_loaded").css("display","block"),h(),a("#ond_homework_timetable_loaded").html(g.htmltimetable),a("#ond_homework_timetable_loading").css("display","none"),a("#ond_homework_timetable_loaded").css("display","block"),a("#ond_homework_timetable td").mouseenter(function(){a(this).children(".ond_homework_timetable_actions").css("visibility","visible")}).mouseleave(function(){a(this).children(".ond_homework_timetable_actions").css("visibility","hidden")})):(a("#ond_homework_list_loading").css("display","none"),a("#ond_homework_list_loaded").html('<h4 class="ond_failure">'+g+"<h4>"),a("#ond_homework_list_loaded").css("display","block"),a("#ond_homework_timetable_loaded")&&(a("#ond_homework_timetable_loaded").html('<h4 class="ond_failure">'+g+"<h4>"),a("#ond_homework_timetable_loading").css("display","none"),a("#ond_homework_timetable_loaded").css("display","block")),console.log(b)),a("#date").prop("disabled",!1)})},h=function(){if(a("#ond_homework_list")&&!f&&e){var c=a("#ond_homework_list th").length-1;b.initialise("ond_homework_list",[c,"desc"],M.cfg.wwwroot+"/blocks/homework"),f=!0}}};return new c});